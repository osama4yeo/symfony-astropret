{# templates/materiel/index.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Liste du Matériel Disponible{% endblock %}

{% block body_content %}
    <div class="container mt-4">
        <h1 class="mb-4">Liste du Matériel Disponible</h1>

        {% include 'partials/_flash_messages.html.twig' ignore missing %}

        {% if materiels is not empty %}
            <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-4 g-4">
                {% for materiel_item in materiels %}
                    <div class="col d-flex align-items-stretch">
                        <div class="card w-100 shadow-sm">
                            
                            {# Affichage de l'image - MODIFIÉ #}
                            {% if materiel_item.imageFilename %}
                                <img src="{{ asset('images/materiel/' ~ materiel_item.imageFilename) }}" 
                                     class="card-img-top square-image card-materiel-img" 
                                     alt="{{ materiel_item.nom }}">
                            {% else %}
                                <img src="{{ asset('images/materiel/default_equipment.jpg') }}" 
                                     class="card-img-top square-image card-materiel-img" 
                                     alt="Image non disponible" 
                                     style="filter: grayscale(80%);"> {# Garde le filtre grayscale #}
                            {% endif %}
                            {# FIN DE LA MODIFICATION DE L'IMAGE #}

                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">{{ materiel_item.nom }}</h5>
                                <p class="card-text mb-2">
                                    État : 
                                    {% set etat_class = materiel_item.etat == constant('App\\Entity\\Materiel::ETAT_LIBRE') ? 'success' : (materiel_item.etat == constant('App\\Entity\\Materiel::ETAT_LOUE') ? 'warning' : 'secondary') %}
                                    <span class="badge bg-{{ etat_class }}">{{ materiel_item.etat | capitalize }}</span>
                                </p>
                                <div class="mt-auto text-center pt-2">
                                    {% if materiel_item.etat == constant('App\\Entity\\Materiel::ETAT_LIBRE') %}
                                        <a href="{{ path('reservation_new', {'materielId': materiel_item.id}) }}" class="btn btn-primary">
                                            Louer cet article
                                        </a>
                                    {% else %}
                                        <button class="btn btn-secondary" disabled>Indisponible</button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-info mt-4" role="alert">
                Aucun matériel disponible pour le moment.
            </div>
        {% endif %}
    </div>
{% endblock body_content %}

{% block stylesheets %}
    {{ parent() }}
    {# Les styles pour .card-img-top et .card-title sont déjà dans style.css ou inline dans base.html.twig,
       mais vous pouvez garder des styles spécifiques ici si besoin.
       La classe .card-materiel-img dans style.css s'occupe de la bordure.
    #}
    <style>
        .card-title {
            min-height: 2.5rem; 
            margin-bottom: 0.5rem; 
        }
        /* .card-img-top {
             border-bottom: 1px solid #eee; 
        } A été déplacé dans .card-materiel-img dans style.css */
    </style>
{% endblock %}